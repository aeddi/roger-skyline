# Generated by iptables-save v1.4.21 on Sat Oct  8 11:30:51 2016
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [425:46725]

# SSH only from gateway and Ansible server
-A INPUT -s 192.168.54.1/32 -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -s 192.168.54.10/32 -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -s 192.168.154.254/32 -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -s 192.168.154.10/32 -p tcp -m tcp --dport 22 -j ACCEPT

# Zabbix HTTP/S interface accessible from gateway only
-A INPUT -s 192.168.154.254/32 -p tcp -m multiport --dport 80,443 -j ACCEPT 

# LDAP accessible from gateway, mail
-A INPUT -s 192.168.154.254/32 -p tcp -m tcp --dport 636 -j ACCEPT
-A INPUT -s 192.168.154.2/32 -p tcp -m tcp --dport 636 -j ACCEPT

# rsyslog server accessible from all other intra hosts
-A INPUT -s 192.168.154.0/24 -p tcp -m tcp --dport 514 -j ACCEPT

# Zabbix server accessible from all other intra hosts
-A INPUT -s 192.168.154.0/24 -p tcp -m tcp --dport 10051 -j ACCEPT

# Zabbix agent accessible only from Zabbix server
-A INPUT -s 192.168.154.9/32 -p tcp -m tcp --dport 10050 -j ACCEPT

# ICMP accessible only from Zabbix server, Ansible server and gateway
-A INPUT -s 192.168.54.1/32 -p icmp -j ACCEPT
-A INPUT -s 192.168.54.10/32 -p icmp -j ACCEPT
-A INPUT -s 192.168.154.254/32 -p icmp -j ACCEPT
-A INPUT -s 192.168.154.10/32 -p icmp -j ACCEPT
-A INPUT -s 192.168.154.9/32 -p icmp -j ACCEPT

# Allow lookup responses
-A INPUT -s 192.168.154.254/32 -p udp -m udp --sport 53 --dport 1024:65535 -j ACCEPT

# Allow outgoing connection to connect back
-A INPUT -m state --state ESTABLISHED -j ACCEPT

# Allow all traffic from localhost
-A INPUT -i lo -j ACCEPT

# Reject everything else
-A INPUT -j REJECT --reject-with icmp-port-unreachable

COMMIT
# # Completed on Sat Oct  8 11:30:51 2016
