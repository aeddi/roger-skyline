# Generated by iptables-save v1.4.21 on Sat Oct  8 11:30:51 2016
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [425:46725]

# SSH only from 42 School, gateway, backup agent and ansible
-A INPUT -s 10.0.0.0/8 -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -s 192.168.54.1/32 -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -s 192.168.154.254/32 -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -s 192.168.154.3/32 -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -s 192.168.54.10/32 -p tcp -m tcp --dport 22 -j ACCEPT

# SSH from web_workers and preprod
-A INPUT -s 192.168.154.4/32 -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -s 192.168.154.5/32 -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -s 192.168.154.10/32 -p tcp -m tcp --dport 22 -j ACCEPT

# Zabbix agent accessible only from Zabbix server
-A INPUT -s 192.168.154.9/32 -p tcp -m tcp --dport 10050 -j ACCEPT

# ICMP accessible only from Zabbix server, gateway and ansible
-A INPUT -s 192.168.54.1/32 -p icmp -j ACCEPT
-A INPUT -s 192.168.154.9/32 -p icmp -j ACCEPT
-A INPUT -s 192.168.54.10/32 -p icmp -j ACCEPT

# Allow lookup responses
-A INPUT -s 192.168.154.254/32 -p udp -m udp --sport 53 --dport 1024:65535 -j ACCEPT

# Allow outgoing connection to connect back
-A INPUT -m state --state ESTABLISHED -j ACCEPT

# Allow all traffic from localhost
-A INPUT -i lo -j ACCEPT

# Allow web traffic
-A INPUT -s 10.0.0.0/8 -p tcp -m multiport --dport 80,443 -j ACCEPT

# Allow web traffic for buildbot (CI)
-A INPUT -s 10.0.0.0/8 -p tcp -m multiport --dport 8083,4433 -j ACCEPT
# Allow master/worker traffic (CI)
-A INPUT -s 192.168.154.10/32 -p tcp --dport 9989 -j ACCEPT

# Postgresql accessible from XMPP
-A INPUT -s 192.168.154.3/32 -p tcp -m tcp --dport 5432 -j ACCEPT

# Reject everything else
-A INPUT -j REJECT --reject-with icmp-port-unreachable

COMMIT
# # Completed on Sat Oct  8 11:30:51 2016
